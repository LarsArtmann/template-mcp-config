%% Improved MCP Configuration Architecture (CLEAN & SEPARATED)
%% This diagram shows how the architecture SHOULD BE

graph TD
    %% Configuration Layer - CLEAN & TYPED
    subgraph Config["âœ… CLEAN CONFIGURATION"]
        Schema["ğŸ¯ TypeSpec Schema<br/>âœ… Single source of truth<br/>âœ… Type-safe definitions<br/>âœ… Auto-generated validation"]
        Generated["ğŸ”„ Generated Assets<br/>âœ… JSON Schema<br/>âœ… TypeScript types<br/>âœ… OpenAPI docs<br/>âœ… Validation functions"]
        MCPConfig[".mcp.json<br/>âœ… Schema-validated<br/>âœ… Type-safe<br/>âœ… Auto-completion"]
        EnvConfig[".env<br/>âœ… Schema-defined<br/>âœ… Type-validated<br/>âœ… Required vs optional"]
    end

    %% Validation Layer - MODULAR & FOCUSED
    subgraph Validation["ğŸ” MODULAR VALIDATION"]
        ConfigValidator["config-validator.ts<br/>âœ… Single responsibility<br/>âœ… Uses generated schema<br/>âœ… Pure functions"]
        EnvValidator["env-validator.ts<br/>âœ… Environment-specific<br/>âœ… Type-safe<br/>âœ… Clear error messages"]
        ConnectivityValidator["connectivity-validator.ts<br/>âœ… Network testing only<br/>âœ… Async/parallel<br/>âœ… Timeout handling"]
        ValidationOrchestrator["validation-orchestrator.ts<br/>âœ… Coordinates validators<br/>âœ… Aggregates results<br/>âœ… Structured reporting"]
    end

    %% Testing Layer - CLEAN SEPARATION
    subgraph Testing["ğŸ§ª CLEAN TESTING"]
        UnitTests["unit-tests/<br/>âœ… Pure function testing<br/>âœ… Mock dependencies<br/>âœ… Fast execution"]
        IntegrationTests["integration-tests/<br/>âœ… Server connectivity<br/>âœ… Real dependencies<br/>âœ… Isolated tests"]
        E2ETests["e2e-tests/<br/>âœ… Full workflow testing<br/>âœ… Real environment<br/>âœ… User scenarios"]
        TestOrchestrator["test-orchestrator.ts<br/>âœ… Single test runner<br/>âœ… Parallel execution<br/>âœ… Unified reporting"]
    end

    %% Reporting Layer - STRUCTURED OUTPUT
    subgraph Reporting["ğŸ“Š STRUCTURED REPORTING"]
        ReportGenerator["report-generator.ts<br/>âœ… Multiple formats<br/>âœ… JSON/HTML/Console<br/>âœ… Template-based"]
        HealthDashboard["health-dashboard/<br/>âœ… Real-time status<br/>âœ… Historical data<br/>âœ… Performance metrics"]
        AlertManager["alert-manager.ts<br/>âœ… Failure notifications<br/>âœ… Threshold monitoring<br/>âœ… Recovery tracking"]
    end

    %% CI/CD Pipeline - AUTOMATED QUALITY
    subgraph Pipeline["ğŸš€ CI/CD PIPELINE"]
        PreCommit["pre-commit hooks<br/>âœ… Schema validation<br/>âœ… Type checking<br/>âœ… Linting"]
        CI["GitHub Actions<br/>âœ… Full test suite<br/>âœ… Performance benchmarks<br/>âœ… Security scanning"]
        CD["Automated deployment<br/>âœ… Schema migration<br/>âœ… Rollback capability<br/>âœ… Health monitoring"]
    end

    %% Data Flow (GREEN = GOOD)
    Schema -->|"âœ… generates"| Generated
    Generated -->|"âœ… validates"| MCPConfig
    Generated -->|"âœ… validates"| EnvConfig
    
    MCPConfig --> ConfigValidator
    EnvConfig --> EnvValidator
    ConfigValidator --> ValidationOrchestrator
    EnvValidator --> ValidationOrchestrator
    ConnectivityValidator --> ValidationOrchestrator
    
    ValidationOrchestrator -->|"âœ… triggers"| TestOrchestrator
    UnitTests --> TestOrchestrator
    IntegrationTests --> TestOrchestrator
    E2ETests --> TestOrchestrator
    
    TestOrchestrator --> ReportGenerator
    ValidationOrchestrator --> ReportGenerator
    ReportGenerator --> HealthDashboard
    ReportGenerator --> AlertManager
    
    PreCommit -->|"âœ… validates"| Schema
    CI -->|"âœ… runs"| TestOrchestrator
    CD -->|"âœ… monitors"| HealthDashboard

    %% Single Orchestrator - THE SOLUTION
    subgraph Orchestrator["ğŸ¯ SINGLE ORCHESTRATOR"]
        MainOrchestrator["main-orchestrator.ts<br/>âœ… Single entry point<br/>âœ… Coordinates all layers<br/>âœ… Command pattern<br/>âœ… Event-driven<br/>âœ… Plugin architecture"]
    end
    
    MainOrchestrator -->|"âœ… coordinates"| ValidationOrchestrator
    MainOrchestrator -->|"âœ… coordinates"| TestOrchestrator
    MainOrchestrator -->|"âœ… coordinates"| ReportGenerator
    MainOrchestrator -->|"âœ… coordinates"| AlertManager

    %% Key Improvements Legend
    subgraph Improvements["âœ… ARCHITECTURAL WINS"]
        I1["âœ… SINGLE SOURCE OF TRUTH: TypeSpec schema drives everything"]
        I2["âœ… TYPE SAFETY: Generated types, no runtime surprises"]
        I3["âœ… SEPARATION OF CONCERNS: Each module has one job"]
        I4["âœ… ZERO DUPLICATION: Shared generated code"]
        I5["âœ… TESTABLE: Pure functions, dependency injection"]
        I6["âœ… MAINTAINABLE: Clear boundaries, plugin architecture"]
        I7["âœ… OBSERVABLE: Structured reporting and monitoring"]
        I8["âœ… AUTOMATED: CI/CD pipeline with quality gates"]
    end

    %% Command Pattern Implementation
    subgraph Commands["âš¡ COMMAND PATTERN"]
        ValidateCommand["ValidateCommand<br/>âœ… Pure command<br/>âœ… Undo/Redo capable<br/>âœ… Loggable"]
        TestCommand["TestCommand<br/>âœ… Parallel execution<br/>âœ… Progress tracking<br/>âœ… Cancellable"]
        ReportCommand["ReportCommand<br/>âœ… Multiple formats<br/>âœ… Template system<br/>âœ… Cacheable"]
        HealthCommand["HealthCommand<br/>âœ… Real-time monitoring<br/>âœ… Alert integration<br/>âœ… Historical data"]
    end
    
    MainOrchestrator -->|"âœ… executes"| ValidateCommand
    MainOrchestrator -->|"âœ… executes"| TestCommand
    MainOrchestrator -->|"âœ… executes"| ReportCommand
    MainOrchestrator -->|"âœ… executes"| HealthCommand

    %% Style the improvements
    classDef goodNode fill:#00b894,stroke:#00a085,stroke-width:2px,color:#fff
    classDef greatNode fill:#6c5ce7,stroke:#5f3dc4,stroke-width:3px,color:#fff
    classDef excellentNode fill:#fd79a8,stroke:#e84393,stroke-width:3px,color:#fff
    classDef goodEdge stroke:#00b894,stroke-width:2px
    
    class Config,Validation,Testing,Reporting goodNode
    class Pipeline,Orchestrator greatNode
    class Commands,MainOrchestrator excellentNode