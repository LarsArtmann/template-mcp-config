%% Current Events & Commands Architecture (PROCEDURAL MESS)
%% This diagram shows the current TERRIBLE event handling and command execution

graph TD
    %% Current Procedural Hell
    subgraph Current["ğŸ”¥ CURRENT PROCEDURAL HELL"]
        
        %% Script Execution - NO COORDINATION
        subgraph Scripts["ğŸ’¥ SCRIPT CHAOS"]
            ValidateScript["validate-config.js<br/>ğŸ’€ Direct execution<br/>ğŸ’€ No event system<br/>ğŸ’€ Blocking operations<br/>ğŸ’€ No progress tracking"]
            TestScript["test-servers.js<br/>ğŸ’€ Hardcoded workflow<br/>ğŸ’€ No cancellation<br/>ğŸ’€ Mixed concerns<br/>ğŸ’€ Poor error handling"]
            HealthScript["health-check.js<br/>ğŸ’€ Polling nightmare<br/>ğŸ’€ No event streams<br/>ğŸ’€ Resource leaks<br/>ğŸ’€ No coordination"]
            SetupScript["setup.js<br/>ğŸ’€ Sequential execution<br/>ğŸ’€ No rollback<br/>ğŸ’€ No progress indication<br/>ğŸ’€ Failure cascade"]
        end

        %% No Event System
        subgraph NoEvents["ğŸ‘» NO EVENT SYSTEM"]
            NoEventBus["âŒ No Event Bus<br/>ğŸ’€ Scripts can't communicate<br/>ğŸ’€ No coordination<br/>ğŸ’€ No progress sharing"]
            NoEventLog["âŒ No Event Logging<br/>ğŸ’€ No audit trail<br/>ğŸ’€ No debugging info<br/>ğŸ’€ No monitoring"]
            NoPubSub["âŒ No Pub/Sub<br/>ğŸ’€ Tight coupling<br/>ğŸ’€ No loose coupling<br/>ğŸ’€ Monolithic execution"]
        end

        %% Command Pattern Missing
        subgraph NoCommands["ğŸš« NO COMMAND PATTERN"]
            NoUndo["âŒ No Undo/Redo<br/>ğŸ’€ Can't rollback operations<br/>ğŸ’€ No transaction safety<br/>ğŸ’€ Manual recovery only"]
            NoQueue["âŒ No Command Queue<br/>ğŸ’€ No batch operations<br/>ğŸ’€ No prioritization<br/>ğŸ’€ No throttling"]
            NoComposition["âŒ No Command Composition<br/>ğŸ’€ Can't chain operations<br/>ğŸ’€ No conditional execution<br/>ğŸ’€ No parallel workflows"]
        end

        %% Process Management Hell
        subgraph ProcessHell["âš¡ PROCESS MANAGEMENT HELL"]
            BlockingCalls["ğŸš« Blocking Calls<br/>ğŸ’€ spawn() with no async control<br/>ğŸ’€ No timeout management<br/>ğŸ’€ Process zombie risk<br/>ğŸ’€ Resource exhaustion"]
            NoProcessPool["âŒ No Process Pool<br/>ğŸ’€ Unlimited process spawning<br/>ğŸ’€ No resource limits<br/>ğŸ’€ System overload risk"]
            PoorErrorHandling["ğŸ’¥ Poor Error Handling<br/>ğŸ’€ Process crashes unhandled<br/>ğŸ’€ No graceful degradation<br/>ğŸ’€ Error cascade failures"]
        end

        %% User Experience Disaster
        subgraph UXDisaster["ğŸ˜¤ USER EXPERIENCE DISASTER"]
            NoProgress["âŒ No Progress Feedback<br/>ğŸ’€ Silent execution<br/>ğŸ’€ Users don't know what's happening<br/>ğŸ’€ Appears frozen"]
            NoInterruption["âŒ No Interruption<br/>ğŸ’€ Can't cancel operations<br/>ğŸ’€ Ctrl+C kills everything<br/>ğŸ’€ No graceful shutdown"]
            InconsistentOutput["ğŸŒ€ Inconsistent Output<br/>ğŸ’€ Different scripts different formats<br/>ğŸ’€ No unified reporting<br/>ğŸ’€ Poor debugging"]
        end

        %% Data Flow Nightmare
        ValidateScript -.->|"ğŸ’€ NO COORDINATION"| TestScript
        TestScript -.->|"ğŸ’€ NO COMMUNICATION"| HealthScript
        HealthScript -.->|"ğŸ’€ NO FEEDBACK"| SetupScript
        
        BlockingCalls -.->|"ğŸ’€ BLOCKS"| ValidateScript
        BlockingCalls -.->|"ğŸ’€ BLOCKS"| TestScript
        BlockingCalls -.->|"ğŸ’€ BLOCKS"| HealthScript
        
        NoEvents -.->|"ğŸ’€ NO COORDINATION"| Scripts
        NoCommands -.->|"ğŸ’€ NO STRUCTURE"| ProcessHell
        ProcessHell -.->|"ğŸ’€ POOR UX"| UXDisaster
    end

    %% Current Justfile/Package.json Mess
    subgraph TaskRunners["ğŸ”„ TASK RUNNER DUPLICATION"]
        PackageScripts["package.json scripts<br/>ğŸ’€ 73 scripts<br/>ğŸ’€ No event coordination<br/>ğŸ’€ Direct node calls<br/>ğŸ’€ No composition"]
        JustCommands["justfile commands<br/>ğŸ’€ 108 lines<br/>ğŸ’€ Duplicates package.json<br/>ğŸ’€ Shell script hell<br/>ğŸ’€ No error propagation"]
        
        PackageScripts -.->|"ğŸ’€ DUPLICATES"| JustCommands
        JustCommands -.->|"ğŸ’€ NO COORDINATION"| Scripts
    end

    %% Problems with Current Approach
    subgraph Problems["ğŸš¨ CURRENT PROBLEMS"]
        P1["ğŸ’€ NO COORDINATION: Scripts run in isolation"]
        P2["ğŸ’€ NO COMMUNICATION: Can't share progress/state"]  
        P3["ğŸ’€ NO COMPOSITION: Can't build complex workflows"]
        P4["ğŸ’€ NO ROLLBACK: Operations can't be undone"]
        P5["ğŸ’€ NO MONITORING: No visibility into execution"]
        P6["ğŸ’€ NO CANCELLATION: Operations can't be stopped"]
        P7["ğŸ’€ RESOURCE LEAKS: Processes not managed properly"]
        P8["ğŸ’€ POOR UX: No feedback, inconsistent output"]
    end

    %% Example of Current Terrible Flow
    subgraph BadFlow["ğŸ’¥ TYPICAL TERRIBLE EXECUTION FLOW"]
        Start["User runs 'just test'"]
        Start --> Shell["Shell executes justfile"]
        Shell --> Node["Node spawns test-servers.js"]
        Node --> Spawn1["spawn() server 1"]
        Spawn1 --> Block1["â³ BLOCKS waiting"]
        Block1 --> Spawn2["spawn() server 2"]
        Spawn2 --> Block2["â³ BLOCKS waiting"]
        Block2 --> Spawn3["spawn() server 3..."]
        Spawn3 --> Error["ğŸ’¥ Server 15 fails"]
        Error --> Cascade["ğŸ’€ ALL FAIL - no recovery"]
        Cascade --> UserConfused["ğŸ˜¤ User gets cryptic error"]
        
        %% No Events During This Flow
        Node -.->|"âŒ No progress events"| Block1
        Block1 -.->|"âŒ No status updates"| Block2  
        Block2 -.->|"âŒ No intermediate results"| Error
    end

    %% Style the problems
    classDef problemNode fill:#ff6b6b,stroke:#d63031,stroke-width:3px,color:#fff
    classDef missingNode fill:#6c5ce7,stroke:#5f3dc4,stroke-width:2px,color:#fff
    classDef terribleFlow fill:#fd79a8,stroke:#e84393,stroke-width:2px,color:#fff
    classDef duplicateEdge stroke:#ff6b6b,stroke-width:3px,stroke-dasharray:10,5
    
    class Scripts,ProcessHell,UXDisaster,TaskRunners problemNode
    class NoEvents,NoCommands,NoEventBus,NoEventLog,NoPubSub missingNode
    class BadFlow,Start,Shell,Node,Spawn1,Block1,Spawn2,Block2,Error,Cascade terribleFlow